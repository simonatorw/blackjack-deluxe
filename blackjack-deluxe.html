<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Blackjack Deluxe</title>
		<style>
			body {
				background-color: #000;
				font-family: verdana, sans-serif;
				font-size: 12px;
				color: #fff;
				display: flex;
				align-items: center;
				justify-content: center;	
			}
			.container {
				display: flex;
				max-width: 1200px;
				border: 1px solid #666;
				padding: 10px;
				flex: 0 0 100%;
				flex-flow: row wrap;
				justify-content: center;
			}
			.card {
				flex: 0 0 6%;
				height: 120px;
				background-color: #fff;
				border-radius: 3px;
				padding: 6px;
				margin: 0 10px 10px 0;
			}
			.value {
			    font-family: times, serif;
				font-size: 2em;
				font-weight: bold;
			}
			.suit {
				font-size: 3em;
				text-align: center;
				margin-top: 10px;
			}
			.value.spade, .value.club {
				color: #000;
			}
			.value.diamond, .value.heart {
				color: #f00;
			}
			.suit.diamond:before {
				content: "\2666";
				color: #f00;
			}			
			.suit.club:before {
				content: "\2663";
				color: #000;
			}			
			.suit.heart:before {
				content: "\2665";
				color: #f00;
			}
			.suit.spade:before {
				content: "\2660";
				color: #000;
			}
			
		</style>
	</head>
	<body>
		<div class="container"></div>
		<script>
			class BlackjackDeluxe {
				constructor(decks, suits, values) {
					console.log('Running...');
					this.suitsMap = ['diamond', 'club', 'heart', 'spade'];
					this.dealt = null;
					this.decks = decks || 6;
					this.suits = suits || 4;
					this.values = values || 13;
					this.numDealt = 0;
					this.maxCards = this.decks * this.suits * this.values;
					this.init();
				}
				shuffle() {
					this.dealt = new Array(this.decks);
					for (let i = 0; i < this.decks; i++) {
						this.dealt[i] = new Array(this.suits);
						for (let j = 0; j < this.suits; j++) {
							this.dealt[i][j] = new Array(this.values);
						}
					}
					console.log(this.dealt);
				}
				drawCard() {
					let val, suit, card;
					do {
						val = (Math.floor(Math.random() * this.values)) + 1;
						suit = Math.floor(Math.random() * this.suits);
						card = { val, suit };
					} while (!this.isUnique(card));
					this.record(card);
					return card;
					
				}
				record(card) {
					const list = this.dealt;
					this.numDealt++;
					for (let i = 0; i < this.decks; i++) {
						if (!list[i][card.suit][card.val]) {
							list[i][card.suit][card.val] = 1;
							break;
						}
					}
				}
				isUnique(card) {
					if (this.numDealt > this.maxCards) {
						return true;
					}
					let checked = 0;
					for (let i = 0; i < this.decks; i++) {
						if (this.dealt[i][card.suit][card.val]) {
							checked++;
						}
					}
					return !(checked === this.decks);
				}
				mapValue(val) {
					switch(val) {
						case 1:
							return 'A';
						case 11:
							return 'J';
						case 12:
							return 'Q';
						case 13:
							return 'K';
						default:
							return val;
					}
				}
				mapSuit(suit) {
					return this.suitsMap[suit]; 
				}
				renderCard(card) {
					const val = this.mapValue(card.val);
					const suit = this.mapSuit(card.suit);
					const $container = document.getElementsByClassName('container')[0];
					console.log(val, suit);
					const tpl = `<div class="card">
						<div class="value ${suit}">${val}</div>
						<div class="suit ${suit}"></div>
					</div>`;
					
					$container.insertAdjacentHTML('beforeend', tpl);				
				}
				events() {
				
				}
				init() {
					this.shuffle();
				
					while (this.numDealt < this.maxCards) {
						let card = this.drawCard();
						this.renderCard(card);
					}
					console.log(this.dealt);
					//this.events();
				}
			}
			
			new BlackjackDeluxe();
		</script>
	</body>
</html>